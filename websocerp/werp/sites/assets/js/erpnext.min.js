frappe.provide('erpnext');$(document).bind('toolbar_setup',function(){frappe.app.name="ERPNext";$('.navbar-brand').html('<i class="icon-home"></i>').attr("title","Home").addClass("navbar-icon-home").css({"max-width":"200px","text-overflow":"ellipsis","white-space":"nowrap"});$('[data-link="docs"]').attr("href","https://erpnext.com/user-guide")});;pscript.feature_dict={'fs_projects':{'BOM':{'fields':['project_name']},'Delivery Note':{'fields':['project_name']},'Purchase Invoice':{'entries':['project_name']},'Production Order':{'fields':['project_name']},'Purchase Order':{'po_details':['project_name']},'Purchase Receipt':{'purchase_receipt_details':['project_name']},'Sales Invoice':{'fields':['project_name']},'Sales Order':{'fields':['project_name']},'Stock Entry':{'fields':['project_name']},'Timesheet':{'timesheet_details':['project_name']}},'fs_discounts':{'Delivery Note':{'delivery_note_details':['discount_percentage']},'Quotation':{'quotation_details':['discount_percentage']},'Sales Invoice':{'entries':['discount_percentage']},'Sales Order':{'sales_order_details':['discount_percentage','price_list_rate']}},'fs_purchase_discounts':{'Purchase Order':{'po_details':['base_price_list_rate','discount_percentage','price_list_rate']},'Purchase Receipt':{'purchase_receipt_details':['base_price_list_rate','discount_percentage','price_list_rate']},'Purchase Invoice':{'entries':['base_price_list_rate','discount_percentage','price_list_rate']}},'fs_brands':{'Delivery Note':{'delivery_note_details':['brand']},'Material Request':{'indent_details':['brand']},'Item':{'fields':['brand']},'Purchase Order':{'po_details':['brand']},'Purchase Invoice':{'entries':['brand']},'Quotation':{'quotation_details':['brand']},'Sales Invoice':{'entries':['brand']},'Sales BOM':{'fields':['new_item_brand']},'Sales Order':{'sales_order_details':['brand']},'Serial No':{'fields':['brand']}},'fs_after_sales_installations':{'Delivery Note':{'fields':['installation_status','per_installed'],'delivery_note_details':['installed_qty']}},'fs_item_batch_nos':{'Delivery Note':{'delivery_note_details':['batch_no']},'Item':{'fields':['has_batch_no']},'Purchase Receipt':{'purchase_receipt_details':['batch_no']},'Quality Inspection':{'fields':['batch_no']},'Sales and Pruchase Return Wizard':{'return_details':['batch_no']},'Sales Invoice':{'entries':['batch_no']},'Stock Entry':{'mtn_details':['batch_no']},'Stock Ledger Entry':{'fields':['batch_no']}},'fs_item_serial_nos':{'Customer Issue':{'fields':['serial_no']},'Delivery Note':{'delivery_note_details':['serial_no'],'packing_details':['serial_no']},'Installation Note':{'installed_item_details':['serial_no']},'Item':{'fields':['has_serial_no']},'Maintenance Schedule':{'item_maintenance_detail':['serial_no'],'maintenance_schedule_detail':['serial_no']},'Maintenance Visit':{'maintenance_visit_details':['serial_no']},'Purchase Receipt':{'purchase_receipt_details':['serial_no']},'Quality Inspection':{'fields':['item_serial_no']},'Sales and Pruchase Return Wizard':{'return_details':['serial_no']},'Sales Invoice':{'entries':['serial_no']},'Stock Entry':{'mtn_details':['serial_no']},'Stock Ledger Entry':{'fields':['serial_no']}},'fs_item_barcode':{'Item':{'fields':['barcode']},'Delivery Note':{'delivery_note_details':['barcode']},'Sales Invoice':{'entries':['barcode']}},'fs_item_group_in_details':{'Delivery Note':{'delivery_note_details':['item_group']},'Opportunity':{'enquiry_details':['item_group']},'Material Request':{'indent_details':['item_group']},'Item':{'fields':['item_group']},'Global Defaults':{'fields':['default_item_group']},'Purchase Order':{'po_details':['item_group']},'Purchase Receipt':{'purchase_receipt_details':['item_group']},'Purchase Voucher':{'entries':['item_group']},'Quotation':{'quotation_details':['item_group']},'Sales Invoice':{'entries':['item_group']},'Sales BOM':{'fields':['serial_no']},'Sales Order':{'sales_order_details':['item_group']},'Serial No':{'fields':['item_group']},'Sales Partner':{'partner_target_details':['item_group']},'Sales Person':{'target_details':['item_group']},'Territory':{'target_details':['item_group']}},'fs_page_break':{'Delivery Note':{'delivery_note_details':['page_break'],'packing_details':['page_break']},'Material Request':{'indent_details':['page_break']},'Purchase Order':{'po_details':['page_break']},'Purchase Receipt':{'purchase_receipt_details':['page_break']},'Purchase Voucher':{'entries':['page_break']},'Quotation':{'quotation_details':['page_break']},'Sales Invoice':{'entries':['page_break']},'Sales Order':{'sales_order_details':['page_break']}},'fs_exports':{'Delivery Note':{'fields':['conversion_rate','currency','grand_total','in_words','rounded_total'],'delivery_note_details':['base_price_list_rate','base_amount','base_rate']},'POS Setting':{'fields':['conversion_rate','currency']},'Quotation':{'fields':['conversion_rate','currency','grand_total','in_words','rounded_total'],'quotation_details':['base_price_list_rate','base_amount','base_rate']},'Sales Invoice':{'fields':['conversion_rate','currency','grand_total','in_words','rounded_total'],'entries':['base_price_list_rate','base_amount','base_rate']},'Sales BOM':{'fields':['currency']},'Sales Order':{'fields':['conversion_rate','currency','grand_total','in_words','rounded_total'],'sales_order_details':['base_price_list_rate','base_amount','base_rate']}},'fs_imports':{'Purchase Invoice':{'fields':['conversion_rate','currency','grand_total','in_words','net_total','other_charges_added','other_charges_deducted'],'entries':['base_price_list_rate','base_amount','base_rate']},'Purchase Order':{'fields':['conversion_rate','currency','grand_total','in_words','net_total','other_charges_added','other_charges_deducted'],'po_details':['base_price_list_rate','base_amount','base_rate']},'Purchase Receipt':{'fields':['conversion_rate','currency','grand_total','in_words','net_total','other_charges_added','other_charges_deducted'],'purchase_receipt_details':['base_price_list_rate','base_amount','base_rate']},'Supplier Quotation':{'fields':['conversion_rate','currency']}},'fs_item_advanced':{'Item':{'fields':['item_customer_details']}},'fs_sales_extras':{'Address':{'fields':['sales_partner']},'Contact':{'fields':['sales_partner']},'Customer':{'fields':['sales_team']},'Delivery Note':{'fields':['sales_team']},'Item':{'fields':['item_customer_details']},'Sales Invoice':{'fields':['sales_team']},'Sales Order':{'fields':['sales_team']}},'fs_more_info':{"Customer Issue":{"fields":["more_info"]},'Material Request':{'fields':['more_info']},'Lead':{'fields':['more_info']},'Opportunity':{'fields':['more_info']},'Purchase Invoice':{'fields':['more_info']},'Purchase Order':{'fields':['more_info']},'Purchase Receipt':{'fields':['more_info']},'Supplier Quotation':{'fields':['more_info']},'Quotation':{'fields':['more_info']},'Sales Invoice':{'fields':['more_info']},'Sales Order':{'fields':['more_info']},'Delivery Note':{'fields':['more_info']},},'fs_quality':{'Item':{'fields':['inspection_criteria','inspection_required']},'Purchase Receipt':{'purchase_receipt_details':['qa_no']}},'fs_manufacturing':{'Item':{'fields':['manufacturing']}},'fs_pos':{'Sales Invoice':{'fields':['is_pos']}},'fs_recurring_invoice':{'Sales Invoice':{'fields':['recurring_invoice']}}}
$(document).bind('form_refresh',function(){for(var sys_feat in sys_defaults){if(sys_defaults[sys_feat]=='0'&&(sys_feat in pscript.feature_dict)){if(cur_frm.doc.doctype in pscript.feature_dict[sys_feat]){for(var fort in pscript.feature_dict[sys_feat][cur_frm.doc.doctype]){if(fort=='fields'){hide_field(pscript.feature_dict[sys_feat][cur_frm.doc.doctype][fort]);}else if(cur_frm.fields_dict[fort]){cur_frm.fields_dict[fort].grid.set_column_disp(pscript.feature_dict[sys_feat][cur_frm.doc.doctype][fort],false);}else{msgprint(__('Grid "')+fort+__('" does not exists'));}}}}}});frappe.provide("erpnext");$.extend(erpnext,{get_currency:function(company){if(!company&&cur_frm)
company=cur_frm.doc.company;if(company)
return frappe.get_doc(":Company",company).default_currency||frappe.boot.sysdefaults.currency;else
return frappe.boot.sysdefaults.currency;},toggle_naming_series:function(){if(cur_frm.fields_dict.naming_series){cur_frm.toggle_display("naming_series",cur_frm.doc.__islocal?true:false);}},hide_company:function(){if(cur_frm.fields_dict.company){var companies=Object.keys(locals[":Company"]||{});if(companies.length===1){if(!cur_frm.doc.company)cur_frm.set_value("company",companies[0]);cur_frm.toggle_display("company",false);}}},add_applicable_territory:function(){if(cur_frm.doc.__islocal&&(cur_frm.doc.valid_for_territories||[]).length===0){var default_territory=frappe.defaults.get_user_default("territory");if(default_territory){var territory=frappe.model.add_child(cur_frm.doc,"Applicable Territory","valid_for_territories");territory.territory=default_territory;}}},setup_serial_no:function(grid_row){if(!grid_row.fields_dict.serial_no||grid_row.fields_dict.serial_no.get_status()!=="Write")return;var $btn=$('<button class="btn btn-sm btn-default">'+__("Add Serial No")+'</button>').appendTo($("<div>").css({"margin-bottom":"10px","margin-left":"15px"}).appendTo(grid_row.fields_dict.serial_no.$wrapper));$btn.on("click",function(){var d=new frappe.ui.Dialog({title:__("Add Serial No"),fields:[{"fieldtype":"Link","options":"Serial No","label":__("Serial No"),"get_query":{item_code:grid_row.doc.item_code,warehouse:grid_row.doc.warehouse}},{"fieldtype":"Button","label":__("Add")}]});d.get_input("add").on("click",function(){var serial_no=d.get_value("serial_no");if(serial_no){var val=(grid_row.doc.serial_no||"").split("\n").concat([serial_no]).join("\n");grid_row.fields_dict.serial_no.set_model_value(val.trim());}
d.hide();return false;});d.show();});},});erpnext.utils={render_address_and_contact:function(frm){$(frm.fields_dict['address_html'].wrapper).html(frappe.render(frappe.templates.address_list,cur_frm.doc.__onload)).find(".btn-address").on("click",function(){new_doc("Address");});if(frm.fields_dict['contact_html']){$(frm.fields_dict['contact_html'].wrapper).html(frappe.render(frappe.templates.contact_list,cur_frm.doc.__onload)).find(".btn-contact").on("click",function(){new_doc("Contact");});}}};frappe.provide("erpnext.queries");$.extend(erpnext.queries,{user:function(){return{query:"frappe.core.doctype.user.user.user_query"};},lead:function(){return{query:"erpnext.controllers.queries.lead_query"};},customer:function(){return{query:"erpnext.controllers.queries.customer_query"};},supplier:function(){return{query:"erpnext.controllers.queries.supplier_query"};},item:function(filters){var args={query:"erpnext.controllers.queries.item_query"};if(filters)args["filters"]=filters;return args;},bom:function(){return{query:"erpnext.controllers.queries.bom"};},task:function(){return{query:"erpnext.projects.utils.query_task"};},customer_filter:function(doc){if(!doc.customer){frappe.throw(__("Please specify a")+" "+
__(frappe.meta.get_label(doc.doctype,"customer",doc.name)));}
return{filters:{customer:doc.customer}};},supplier_filter:function(doc){if(!doc.supplier){frappe.throw(__("Please specify a")+" "+
__(frappe.meta.get_label(doc.doctype,"supplier",doc.name)));}
return{filters:{supplier:doc.supplier}};},lead_filter:function(doc){if(!doc.lead){frappe.throw(__("Please specify a")+" "+
__(frappe.meta.get_label(doc.doctype,"lead",doc.name)));}
return{filters:{lead:doc.lead}};},not_a_group_filter:function(){return{filters:{is_group:"No"}};},employee:function(){return{query:"erpnext.controllers.queries.employee_query"}},warehouse:function(doc){return{filters:[["Warehouse","company","in",["",cstr(doc.company)]]]}}});;frappe.provide("erpnext.utils");erpnext.utils.get_party_details=function(frm,method,args,callback){if(!method){method="erpnext.accounts.party.get_party_details";}
if(!args){if(frm.doc.customer){args={party:frm.doc.customer,party_type:"Customer",price_list:frm.doc.selling_price_list};}else if(frm.doc.supplier){args={party:frm.doc.supplier,party_type:"Supplier",price_list:frm.doc.buying_price_list};}}
if(!args)return;args.currency=frm.doc.currency;args.company=frm.doc.company;args.doctype=frm.doc.doctype;frappe.call({method:method,args:args,callback:function(r){if(r.message){frm.updating_party_details=true;frm.set_value(r.message);frm.updating_party_details=false;if(callback)callback();}}});}
erpnext.utils.get_address_display=function(frm,address_field,display_field){if(frm.updating_party_details)return;if(!address_field){if(frm.doc.customer){address_field="customer_address";}else if(frm.doc.supplier){address_field="supplier_address";}else return;}
if(!display_field)display_field="address_display";if(frm.doc[address_field]){frappe.call({method:"erpnext.utilities.doctype.address.address.get_address_display",args:{"address_dict":frm.doc[address_field]},callback:function(r){if(r.message)
frm.set_value(display_field,r.message)}})}}
erpnext.utils.get_contact_details=function(frm){if(frm.updating_party_details)return;if(frm.doc["contact_person"]){frappe.call({method:"erpnext.utilities.doctype.contact.contact.get_contact_details",args:{contact:frm.doc.contact_person},callback:function(r){if(r.message)
frm.set_value(r.message);}})}};frappe.templates["address_list"] = '<p><button class="btn btn-sm btn-default btn-address">     <i class="icon-plus"></i> New Address</button></p> {% for(var i=0, l=addr_list.length; i<l; i++) { %}     <hr>     <a href="#Form/Address/{%= addr_list[i].name %}" class="btn btn-sm btn-default pull-right">         {%= __("Edit") %}</a>     <p><b>{%= i+1 %}. {%= addr_list[i].address_type %}</b></p>     <div style="padding-left: 15px;">         <div>             {% if(addr_list[i].is_primary_address) { %}<span class="label label-info">                 {%= __("Primary") %}</span>{% } %}             {% if(addr_list[i].is_shipping_address) { %}<span class="label label-default">                 {%= __("Shipping") %}</span>{% } %}         </div>         <p style="margin-top: 5px;">{%= addr_list[i].display %}</p>     </div> {% } %} {% if(!addr_list.length) { %} <p class="text-muted">{%= __("No address added yet.") %}</p> {% } %} ';
frappe.templates["contact_list"] = '<p><button class="btn btn-sm btn-default btn-contact">     <i class="icon-plus"></i> New Contact</button></p> {% for(var i=0, l=contact_list.length; i<l; i++) { %}     <hr>     <a href="#Form/Contact/{%= contact_list[i].name %}" class="btn btn-sm btn-default pull-right">         {%= __("Edit") %}</a>     <p><b>{%= i+1 %}. {%= contact_list[i].first_name %} {%= contact_list[i].last_name %}</b></p>     <div style="padding-left: 15px;">         <div>             {% if(contact_list[i].is_primary_contact) { %}<span class="label label-info">                 {%= __("Primary") %}</span>{% } %}         </div>         <p style="padding-top: 5px;">             {% if(contact_list[i].phone) { %}                 {%= __("Phone") %}: {%= contact_list[i].phone %}<br>             {% } %}             {% if(contact_list[i].email_id) { %}                 {%= __("Email Id") %}: {%= contact_list[i].email_id %}             {% } %}         </p>     </div> {% } %} {% if(!contact_list.length) { %} <p class="text-muted">{%= __("No contacts added yet.") %}</p> {% } %} ';
